NOT COMPLETED SKIP FIRST

https://defuse.ca/online-x86-assembler.htm#disassembly

### Stack Cookie - Security Check `/GS protection`

1. SEH - 1/2 Worked

- Basically tldr, if there is an exception, then we can bypass the stack cookie

- Again, does not seem to be working on Windows 7, but made it work partially as shown in the video

2. Virtual Function call - Did not work/Still trying

- In write up, we can control value that EAX populates and control code execution on CALL EAX

- EBP points to our buffer

- Find an address which points to JMP EBP and set EAX to that value

- impossible on like windows 7 or some shit. Will post findings later. Code gets corrupted not on call EAX. complete findings later on

### SafeSeh - Safe Structured Exception Handlers

Somehow, my exploit just worked. LOL.

What is SafeSEH? SafeSEH (Safe Structured Exception Handlers) is a Windows binary protection mechanism for 32-bit executables that has been around for a while now. When the option is enabled, the linker creates a list of valid exception handler addresses in the SEHandlerTable when the binary is being built.

1. Find address outside of address range 

- Find a register (e.g. EBP) which points back to your buffer

- Use !pvefindaddr jseh and find an instruction which allows you to jump back to your overflow

- https://www.ffri.jp/assets/files/research/research_papers/SEH_Overwrite_CanSecWest2010.pdf

- https://www.rcesecurity.com/2012/11/bypassing-safeseh-memory-protection-in-zoner-photo-studio-v15/

- https://resources.infosecinstitute.com/topic/bypassing-seh-protection-a-real-life-example/

- http://sploitfun.blogspot.com/2012/10/bypassing-safeseh.html

- https://securityetalii.wordpress.com/2012/11/25/formatfactory-3-01-stack-based-buffer-overflow-safeseh-bypass/

### SEHOP - Structured Exception Handling Overwrite Protection

At a high-level, SEHOP prevents attackers from being able to use the SEH overwrite technique by verifying that a thread’s exception handler list is intact before allowing any of the registered exception handlers to be called. Somethig like a control flow guard.

https://github.com/GrayHatHacking/GHHv5/issues/4

https://github.com/e3prom/miscsec/tree/master/GHHv5-SEHOP-Bypass

https://www.stigviewer.com/stig/windows_10/2016-06-24/finding/V-68849

https://support.microsoft.com/en-us/topic/how-to-enable-structured-exception-handling-overwrite-protection-sehop-in-windows-operating-systems-8d4595f7-827f-72ee-8c34-fa8e0fe7b915

https://msrc-blog.microsoft.com/2009/02/02/preventing-the-exploitation-of-structured-exception-handler-seh-overwrites-with-sehop/

https://www.rapid7.com/resources/sehop-mitigating-structured-exception-handler-overwrite-vulnerabilities/

https://www.tenable.com/audits/items/CIS_MS_Windows_10_Enterprise_Level_1_v1.7.1.audit:fdfce54719f292e27a18b30e606ee4aa

https://www.ghacks.net/2012/07/16/advanced-windows-security-activating-sehop/

https://www.stigviewer.com/stig/windows_10/2016-06-24/finding/V-68849

https://improsec.com/tech-blog/back-to-basics-or-bypassing-control-flow-guard-with-structured-exception-handler

[Example Exploit](https://packetstormsecurity.com/files/94448/AudioTran-1.4.2.4-SafeSEH-SEHOP-Exploit.html)
  
[SEHOP Article](https://repo.zenk-security.com/Techniques%20d.attaques%20%20.%20%20Failles/EN-Bypassing%20SEHOP.pdf)

https://www.exploit-db.com/exploits/15184

https://www.exploit-db.com/papers/15379

### DEP

Wikipedia states “DEP runs in two modes: hardware-enforced DEP for CPUs that can mark memory pages as nonexecutable (NX bit), and software-enforced DEP with a limited prevention for CPUs that do not have hardware support. Software-enforced DEP does not protect from execution of code in data pages, but instead from another type of attack (SEH overwrite).

Software DEP = Safeseh 

Windows DEP = hardware DEP

When the processor/system has NX/XD support/enabled, then Windows DEP = hardware DEP. 

If the processor does not support it, you don’t get DEP, but only safeseh (when enabled).

When the processor/system does not have NX/XD support/enabled, then Windows DEP = software DEP

1. Ret2Libc

2. ZwProtectVirtualMemory

http://woct-blog.blogspot.com/2005/01/dep-evasion-technique.html

3. Disable DEP for the process (NtSetInformationProcess)

https://fahrishih.medium.com/bypassing-windows-dep-data-execution-prevention-d1a276a973f1

https://www.corelan.be/index.php/2009/09/21/exploit-writing-tutorial-part-6-bypassing-stack-cookies-safeseh-hw-dep-and-aslr/

### ASLR

Nothing much to do TBH

1. using an address from a non-ASLR enabled module

2. partial EIP overwrite

https://www.malavida.com/en/soft/visual-studio-2008/download

https://www.pcmag.com/how-to/install-a-software-program-from-an-iso-file

https://www.elby.ch/products/vcd.html

